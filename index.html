<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Webcam Snapshot</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
    }
    #canvas {
        position: relative;
    }
    #background {
        display: none;
    }
    #video {
        position: relative;
        transform: scaleX(-1);
        -webkit-transform: scaleX(-1);
    }
    .container {
        width: 100%;
        height: 60vh;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .video-container, .preview {
        width: 100%;
        height: 100%;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    #bharathiyarLayout, #previewballon, #ballon {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    .output {
        margin: 20px 0;
        width: 100%;
        height: auto;
        overflow: auto;
        position: relative;
    }
    .btn {
        width: 150px;
        height: 40px;
        border: none;
        border-radius: 4px;
        background-color: #272727;
        color: #FFFFFF;
        font-size: 18px;
        margin: 10px;
        cursor: pointer;
    }
    #previewmyCanvas, #myCanvas {
        width: 100%;
        height: 100%;
    }
</style>
</head>
<body onload="init();initPre();">
<button class="btn" onclick="startWebcam();">Start WebCam</button>
<button class="btn" onclick="stopWebcam();">Stop WebCam</button>
<button class="btn" onclick="snapshot();snapshotPre();">Take Snapshot</button>
<button class="btn" onclick="download()">Download</button>
<button class="btn" onclick="switchCamera();">Switch Camera</button>
 
<div class="container">
<div class="video-container">
<video id="video" controls autoplay></video>
<img id="bharathiyarLayout" alt="" src="./final.png" />
</div>
<div class="preview">
<canvas id="previewmyCanvas"></canvas>
<img id="previewballon" alt="" src="./final.png" />
</div>
</div>
<div class="output">
<canvas id="myCanvas" width="2560" height="1440"></canvas>
<img id="ballon" alt="" src="./final.png" />
</div>
 
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/ui/1.14.0-beta.2/jquery-ui.min.js" integrity="sha256-E7PeZTkHU61hmvmEMwtUMgm9Aff574wswy5F1Y0oIRA=" crossorigin="anonymous"></script>
<script>
    let currentCamera = 0;
    let video;
    let webcamStream;
    let devices = [];
    function startWebcam() {
        if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
            navigator.mediaDevices.enumerateDevices().then((deviceInfos) => {
                devices = deviceInfos.filter(device => device.kind === 'videoinput');
                if (devices.length > 0) {
                    navigator.mediaDevices.getUserMedia({
                        video: { deviceId: devices[currentCamera].deviceId },
                        audio: false,
                    }).then((localMediaStream) => {
                        video = document.querySelector("#video");
                        video.srcObject = localMediaStream;
                        webcamStream = localMediaStream;
                    }).catch((err) => {
                        console.error('Error accessing media devices.', err);
                    });
                } else {
                    console.log("No video input devices found");
                }
            }).catch((err) => {
                console.error('Error enumerating devices.', err);
            });
        } else {
            console.log("getUserMedia not supported");
        }
    }
    function switchCamera() {
        if (devices.length > 1) {
            currentCamera = (currentCamera + 1) % devices.length;
            stopWebcam();
            startWebcam();
        }
    }
    function stopWebcam() {
        if (webcamStream) {
            const tracks = webcamStream.getTracks();
            tracks.forEach(track => track.stop());
        }
    }
    let canvas, ctx;
    let p_canvas, p_ctx;
    function init() {
        p_canvas = document.getElementById("previewmyCanvas");
        p_ctx = p_canvas.getContext("2d");
        p_canvas.width = window.innerWidth;
        p_canvas.height = p_canvas.width * 0.6; // Maintain aspect ratio
    }
    function initPre() {
        canvas = document.getElementById("myCanvas");
        ctx = canvas.getContext("2d");
        canvas.width = 2560;
        canvas.height = 1440;
    }
    function snapshot() {
        p_ctx.save();
        const dpr = window.devicePixelRatio || 1;
        p_ctx.scale(dpr, dpr);
        p_ctx.scale(-1, 1);
        p_ctx.translate(-p_canvas.width / dpr, 0);
        p_ctx.drawImage(video, 0, 0, p_canvas.width / dpr, p_canvas.height / dpr);
        p_ctx.restore();
    }
    function snapshotPre() {
        ctx.save();
        const dpr = window.devicePixelRatio || 1;
        ctx.scale(dpr, dpr);
        ctx.scale(-1, 1);
        ctx.translate(-canvas.width / dpr, 0);
        ctx.drawImage(video, 0, 0, canvas.width / dpr, canvas.height / dpr);
        ctx.restore();
    }
    function download() {
        const ballon = document.getElementById("ballon");
        const $ballon = $("#ballon");
        const $canvas = $("#myCanvas");
        const ballon_x = $ballon.offset().left - $canvas.offset().left;
        const ballon_y = $ballon.offset().top - $canvas.offset().top;
        ctx.drawImage(ballon, ballon_x, ballon_y);
        const img = canvas.toDataURL("image/png");
        const a = document.createElement("a");
        a.href = img;
        a.download = "Pic.png";
        a.click();
    }
    function dragElement(elmnt) {
        let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
        elmnt.onmousedown = dragMouseDown;
        function dragMouseDown(e) {
            e.preventDefault();
            pos3 = e.clientX;
            pos4 = e.clientY;
            document.onmouseup = closeDragElement;
            document.onmousemove = elementDrag;
        }
        function elementDrag(e) {
            e.preventDefault();
            pos1 = pos3 - e.clientX;
            pos2 = pos4 - e.clientY;
            pos3 = e.clientX;
            pos4 = e.clientY;
            elmnt.style.top = elmnt.offsetTop - pos2 + "px";
            elmnt.style.left = elmnt.offsetLeft - pos1 + "px";
        }
        function closeDragElement() {
            document.onmouseup = null;
            document.onmousemove = null;
        }
    }
    // Initialize draggable elements
    dragElement(document.getElementById("ballon"));
    // Handle resizing canvas on window resize
    window.addEventListener('resize', () => {
        init();
        initPre();
    });
</script>
</body>
</html>